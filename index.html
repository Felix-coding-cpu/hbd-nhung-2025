<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Bất ngờ cho Nhung!</title>
    
    <link rel="preload" href="paw-sitive-nhung-1.gif" as="image">
    <link rel="preload" href="hbd-piano-fun.mp3" as="audio">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

    <style>
        :root {
            --pink-bg: #ffe4e1;
            --btn-yes: #ffb6c1;
            --btn-NO: #ff8fa3;
            --text-color: #d87093;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--pink-bg);
            font-family: 'Pacifico', cursive;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }

        #app {
            position: relative; width: 100%; max-width: 500px;
            height: 100dvh; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
            padding: 20px; box-sizing: border-box;
            contain: content; /* Tối ưu hóa render cho trình duyệt */
        }

        #question-area { z-index: 100; width: 100%; transition: opacity 0.4s ease-out; }
        h1 { color: var(--text-color); font-size: clamp(1.4rem, 5vw, 1.8rem); margin-bottom: 20px; }

        .btn-group {
            display: flex; gap: 20px; justify-content: center;
            align-items: center; position: relative; height: 150px;
        }

        .pill-btn {
            padding: 12px 35px; border: none; border-radius: 50px;
            font-family: 'Pacifico', cursive; font-size: 1.1rem;
            cursor: pointer; transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 15px rgba(216, 112, 147, 0.3);
            will-change: transform; /* Tối ưu GPU cho iPhone khi nút to dần */
        }

        #btn-yes { background-color: var(--btn-yes); color: white; z-index: 10; }
        #btn-no { background-color: var(--btn-NO); color: white; z-index: 20; }

        .content-box {
            position: relative; width: 100%; max-width: 380px; aspect-ratio: 1/1;
            display: flex; align-items: center; justify-content: center;
        }

        .main-gif {
            width: 100%; height: 100%; object-fit: contain;
            border-radius: 15px; display: none; cursor: pointer;
        }

        #instruction {
            position: absolute; top: -100px; width: 94%; left: 3%;
            color: var(--text-color); font-size: clamp(0.95rem, 4.5vw, 1.2rem);
            opacity: 0; transition: opacity 0.6s ease;
            z-index: 80; display: flex; flex-direction: column;
            pointer-events: none;
        }

        #envelope {
            position: absolute; width: 75%; max-width: 300px; z-index: 50;
            top: 33.3%; left: 50%; transform: translate(-50%, -50%) scale(0);
            display: none; cursor: pointer;
        }

        #final-card {
            position: fixed; width: 95%; max-width: 420px;
            z-index: 100; display: none;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.2));
            left: 50%; top: 55%; transform: translate(-50%, -50%);
        }

        @keyframes bounceIn {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            60% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        .animate-bounce { animation: bounceIn 0.8s forwards; }

        .confetti { position: fixed; width: 10px; height: 10px; z-index: 99; pointer-events: none; }
    </style>
</head>
<body>

    <audio id="bg-music" loop preload="auto">
        <source src="hbd-piano-fun.mp3" type="audio/mpeg">
    </audio>

    <div id="app">
        <div id="question-area">
            <h1>Em có muốn bất ngờ không?</h1>
            <div class="btn-group">
                <button class="pill-btn" id="btn-yes" onclick="handleYes()">YES</button>
                <button class="pill-btn" id="btn-no" onclick="handleNo()">NO!!</button>
            </div>
        </div>

        <div class="content-box">
            <div id="instruction">Bị lừa rồi :v Ấn vào thư đi</div>
            <img id="gif-display" class="main-gif" src="paw-sitive-nhung-1.gif" alt="">
            <img id="envelope" src="envelope-closed-1.png" onclick="openGift()" alt="">
        </div>

        <img id="final-card" src="paw-sitive-hbd-nhung-1.png" alt="">
    </div>

    <script>
        const elements = {
            btnYes: document.getElementById('btn-yes'),
            btnNo: document.getElementById('btn-no'),
            qArea: document.getElementById('question-area'),
            gif: document.getElementById('gif-display'),
            ins: document.getElementById('instruction'),
            env: document.getElementById('envelope'),
            final: document.getElementById('final-card'),
            music: document.getElementById('bg-music')
        };

        // Preload các ảnh tiếp theo ngay khi trang web đã sẵn sàng (background tasks)
        window.addEventListener('load', () => {
            ["paw-sitive-nhung-3.gif", "envelope-closed-1.png", "paw-sitive-hbd-nhung-1.png"].forEach(f => {
                const i = new Image(); i.src = f;
            });
        });

        let bigScale = 1;

        function handleYes() {
            bigScale += 0.6;
            elements.btnNo.style.transform = `scale(${bigScale})`;
            if (bigScale > 3.5) {
                elements.btnYes.style.opacity = '0';
                elements.btnYes.style.pointerEvents = 'none';
            }
        }

        function handleNo() {
            elements.music.play().catch(() => {});
            elements.qArea.style.opacity = '0';
            setTimeout(() => {
                elements.qArea.style.display = 'none';
                elements.gif.style.display = 'block';
                setTimeout(() => { elements.ins.style.opacity = '1'; }, 100);
            }, 400);
            elements.gif.onclick = triggerEnvelope;
        }

        function triggerEnvelope() {
            elements.gif.onclick = null;
            elements.gif.src = "paw-sitive-nhung-3.gif";
            elements.ins.style.opacity = '0';
            setTimeout(() => {
                elements.ins.textContent = "Tiếp tục ấn mở thư";
                elements.ins.style.opacity = '1';
            }, 500);
            elements.env.style.display = 'block';
            elements.env.classList.add('animate-bounce');
        }

        function openGift() {
            elements.env.style.display = 'none';
            elements.final.style.display = 'block';
            elements.ins.style.opacity = '0';
            setTimeout(() => {
                elements.ins.innerHTML = `
                    <div style="text-align: center; width: 100%;">Chúc mừng sinh nhật Trang Nhung Vũ!!</div>
                    <div style="text-align: right; width: 100%; font-size: 0.8em; margin-top: 3px; padding-right: 5px;">-From: Paw-sitive Chats.</div>
                `;
                elements.ins.style.opacity = '1';
            }, 500);
            startConfetti();
        }

        function startConfetti() {
            const colors = ['#ffb6c1', '#ff69b4', '#ff1493', '#ffd700', '#ffffff'];
            const create = () => {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                document.body.appendChild(conf);
                const d = Math.random() * 3 + 2;
                conf.animate([
                    { top: '-20px', opacity: 1 },
                    { top: '105vh', transform: `translateX(${(Math.random()-0.5)*150}px) rotate(360deg)`, opacity: 0 }
                ], { duration: d * 1000, easing: 'linear' });
                setTimeout(() => conf.remove(), d * 1000);
            };
            setInterval(create, 150);
        }

        document.body.addEventListener('touchstart', () => {
            if (elements.music.paused && elements.qArea.style.display === 'none') elements.music.play();
        }, {once: false});
    </script>
</body>
</html>




